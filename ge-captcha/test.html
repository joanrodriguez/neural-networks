<html>

  <head>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script>

      $(detect);

      function detect(){

        var img = $('img')[0];

        var threshold = 80;

        // create canvas for processing
        var c = document.createElement("canvas");
        var ctx = c.getContext("2d");
        c.width = img.width;
        c.height= img.height;
        // draw image on canvas
        ctx.drawImage(img, 0, 0);
        // retrieve data from canvas
        var data = ctx.getImageData(0,0,img.width,img.height).data;

        // First we traverse the image from left to right through the middle
        // looking for black pixels
        var middle = 4*Math.floor(img.height/2)*img.width;
        for(var i = middle; i<data.length; i = i+4){
          if(data[i]<threshold){
            // Found a black pixel, now discover the letter
            fillLetter(i);
          }
        }

        // "Paint bucket" algorithm that starts with a point in the canvas
        // and finds all adjacent black pixels
        function fillLetter(i){

          // Create an array to store our letter coordinates
          var coords = [];

          // Get x and y of black pixel from index
          var x = ix(i,img.width);
          var y = iy(i,img.width);

          // Add our starting pixel to the stack
          var pixelStack = [[x,y]];

          // Loop through the stack which gets augmented as we discover pixels
          while(pixelStack.length){

            var newPos, x, y, pixelPos, reachLeft, reachRight;

            // newPos is temporary and only used here
            newPos = pixelStack.pop();
            x = newPos[0];
            y = newPos[1];

            // pixelPos is the index in the array
            var pixelPos = xyi(x,y,img.width);

            // Go up until no more black
            while(y>= 0 && data[pixelPos-img.width*4]<threshold){
              y--;
              pixelPos -= img.width * 4;
            }

            // Then we descend through this image
            // as long as there is black
            while(y < img.height && data[pixelPos]<threshold){

              // Collect the coordinate
              coords.push([x,y]);
              // Make the pixel white in the source data in
              // order not to match it again
              //data.splice(pixelPos, 4, 255, 255, 255, 255);
              data.fill(255,pixelPos,pixelPos+4);

              // Go one pixel down
              pixelPos += img.width*4;
              y++;
              // By default we don't grab the pixels on the side
              reachLeft = false;
              reachRight = false;

              // If we are not on the left edge we look left
              if(x > 0)
              {
                if(data[pixelPos-4]<threshold)
                {
                  // The pixel on the left is black so we create a new anchor
                  if(!reachLeft){
                    // New column to explore
                    pixelStack.push([x - 1, y]);
                    reachLeft = true;
                  }
                }
                else if(reachLeft)
                {
                  // The pixel on the left is white so we remove the anchor
                  reachLeft = false;
                }
              }

              // If we are not on the right edge we look right
              if(x < img.width-1)
              {
                if(data[pixelPos+4]<threshold)
                {
                  // The pixel on the right is black so we create a new anchor
                  if(!reachRight)
                  {
                    // New column to explore
                    pixelStack.push([x + 1, y]);
                    reachRight = true;
                  }
                }
                else if(reachRight)
                {
                  // The pixel on the right is white so we remove the anchor
                  reachRight = false;
                }
              }

            }
          }

          var maxX = Math.max.apply(Math,coords.map(function(c){return c[0];}));
          var maxY = Math.max.apply(Math,coords.map(function(c){return c[1];}));
          var minX = Math.min.apply(Math,coords.map(function(c){return c[0];}));
          var minY = Math.min.apply(Math,coords.map(function(c){return c[1];}));

          var c = document.createElement("canvas");
          var ctx = c.getContext("2d");
          c.width = maxX-minX;
          c.height= maxY-minY;

          coords.map(function(c){
            ctx.fillRect(c[0]-minX,c[1]-minY,1,1);
          });

          $('body').append(c);

        }

        function ix(i,w){
          return Math.floor(i/4)%w;
        }

        function iy(i,w){
          return Math.floor(i/(4*w));
        }

        function xyi(x,y,w){
          return (y*w + x) * 4;
        }

      }
    </script>
  </head>
  <body>
    <img src="captchas/7.jpeg" />
  </body>
</html>